<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ISA Master Tool</title>

  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

  <style>
  :root{
    --bg:#050816;
    --stroke: rgba(148,163,184,0.14);
    --text:#e8f0ff;
    --muted:#a7b3d6;

    /* ISA accents */
    --a1:#22d3ee; /* cyan */
    --a2:#818cf8; /* indigo */
    --a3:#38bdf8; /* sky */

    /* SkyLab-ish surfaces */
    --hero-grad: radial-gradient(circle at top, #0b1636 0%, #070f24 55%, #03060f 100%);
    --card-grad: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    --shadow-soft: 0 22px 60px rgba(0,0,0,0.42);
    --shadow: 0 30px 80px rgba(0,0,0,0.55);
  }

  *{box-sizing:border-box}
  html { scroll-behavior: smooth; }
  body{
    margin:0;
    font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    font-weight: 430;                 /* thinner overall */
  }
  a{color:inherit}

  /* ========= Top Nav ========= */
  .top-nav{
    position: sticky;
    top:0;
    z-index:9999;
    backdrop-filter: blur(12px);
    background: linear-gradient(to bottom, rgba(5,8,22,0.92), rgba(5,8,22,0.55));
    border-bottom: 1px solid var(--stroke);
  }
  .top-nav-inner{
    max-width: 1180px;
    margin:0 auto;
    padding: 12px 18px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }

  .brand{
    display:flex;
    align-items:center;
    gap:10px;
    user-select:none;
    font-weight:650;                  /* thinner */
    letter-spacing:0.02em;
    min-width: 220px;
  }
  .brand-badge{
    width:36px;height:36px;
    border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    background: linear-gradient(135deg, rgba(34,211,238,0.22), rgba(129,140,248,0.18));
    border: 1px solid rgba(56,189,248,0.35);
    box-shadow: 0 0 18px rgba(34,211,238,0.18);
    overflow:hidden;
  }
  .brand-badge img{
    width: 100%;
    height: 100%;
    object-fit: cover;
    display:block;
  }

  .brand-badge svg{
    transform: rotate(90deg);
    transform-origin: 50% 50%;
  }

  .brand-title{
    display:flex;
    flex-direction:column;
    line-height:1.05;
  }
  .brand-title .t1{font-size:0.96rem; font-weight:650;}
  .brand-title .t2{font-size:0.74rem;color:var(--muted);font-weight:520;}

  .menu{
    display:flex;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
    justify-content:flex-end;
  }
  .menu a{
    text-decoration:none;
    font-weight:600;                  /* thinner */
    font-size:0.88rem;
    padding: 8px 12px;
    border-radius:999px;
    border: 1px solid rgba(148,163,184,0.16);
    background: rgba(2, 6, 23, 0.35);
    transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease, filter .15s ease;
    white-space:nowrap;
    color:#d8e6ff;
  }
  .menu a:hover{
    border-color: rgba(56,189,248,0.45);
    box-shadow: 0 0 16px rgba(56,189,248,0.14);
    transform: translateY(-1px);
  }

  @media (max-width: 820px){
    .brand-title .t2{display:none}
    .menu a{font-size:0.84rem;padding:7px 10px}
  }
  @media (max-width: 520px){
    .brand-title{display:none}
    .brand{min-width:auto}
  }

  /* ========= Hero (SkyLab spacing, title + gradient, lottie in background) ========= */
  .hero{
    background: var(--hero-grad);
    position: relative;
    overflow:hidden;
    isolation: isolate;           /* prevents stacking issues */
    min-height: 360px;
    display:flex;
    align-items:center;
  }

  /* background lottie layer */
  .hero-bg-lottie{
    position:absolute;
    inset:-40px;
    z-index:0;
    pointer-events:none;
    opacity: 0.16;
    filter: blur(0.4px) saturate(0.9);
    display:flex;
    align-items:center;
    justify-content:center;
    transform: translateY(8px);
  }
  .hero-bg-lottie lottie-player{
    width: min(1400px, 120vw);
    height: 520px;
  }

  /* readable overlay */
  .hero-overlay{
    position:absolute;
    inset:0;
    z-index:1;
    pointer-events:none;
    background:
      radial-gradient(circle at 50% 35%, rgba(0,0,0,0.10), rgba(0,0,0,0.55) 70%),
      linear-gradient(to bottom, rgba(5,8,22,0.25), rgba(5,8,22,0.80));
  }

  /* foreground */
  .hero-inner{
    position: relative;
    z-index:2;
    max-width: 1100px;
    margin:0 auto;
    padding: 62px 18px 56px;
    display:flex;
    flex-direction:column;
    align-items:center;
    text-align:center;
    gap: 12px;
  }

  /* NEW: ISA title with gradient like SkyLab */
  .hero-title{
    margin:0;
    font-size: clamp(2.0rem, 4.4vw, 3.2rem);
    font-weight: 650;                 /* thinner */
    letter-spacing: 0.01em;
    background: linear-gradient(90deg, var(--a1), var(--a3), var(--a2));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 0 10px 28px rgba(0,0,0,0.28);
  }

  .hero-sub{
    margin:0;
    max-width: 860px;
    color: rgba(216,230,255,0.78);
    font-size: 1.02rem;
    line-height:1.6;
    font-weight: 420;                 /* thinner */
  }

  .hero-search{
    margin-top: 10px;
    display:flex;
    gap:12px;
    width: min(760px, 92vw);
    align-items:center;
    justify-content:center;
  }
  .hero-search input{
    flex:1;
    padding: 14px 16px;
    border-radius: 12px;
    border: 1px solid rgba(148,163,184,0.18);
    background: rgba(255,255,255,0.06);
    color: var(--text);
    outline:none;
    font-size: 0.98rem;
    font-weight: 450;
    box-shadow: 0 0 0 1px rgba(3,6,15,0.35);
  }
  .hero-search input::placeholder{color: rgba(167,179,214,0.85)}
  .hero-search input:focus{
    border-color: rgba(56,189,248,0.45);
    box-shadow: 0 0 20px rgba(56,189,248,0.16);
  }
  .hero-search button{
    padding: 14px 16px;
    border-radius: 12px;
    border:none;
    cursor:pointer;
    font-weight:650;                  /* thinner */
    background: linear-gradient(135deg, rgba(56,189,248,0.95), rgba(129,140,248,0.95));
    color:#061021;
    min-width: 90px;
    box-shadow: 0 18px 36px rgba(56,189,248,0.18);
  }
  .hero-search button:hover{filter:brightness(1.06)}

  @media (max-width: 680px){
    .hero{ min-height: 320px; }
    .hero-inner{ padding: 48px 16px 44px; }
    .hero-bg-lottie lottie-player{ height: 440px; }
    .hero-sub{ font-size: 0.98rem; }
  }

  /* ========= Main content wrapper ========= */
  .section{
    padding: 40px 18px 90px;
    background: radial-gradient(circle at top, #050816 0, #020617 55%, #000 100%);
  }
  .wrap{
    max-width: 1180px;
    margin: 0 auto;
  }

  /* ========= Weather block (matches SkyLab layout) ========= */
  .weather-block{
    margin-top: -58px; /* float into hero like SkyLab */
    display:grid;
    grid-template-columns: 1.9fr 1fr;
    gap: 22px;
    align-items:stretch;
  }
  @media (max-width: 980px){
    .weather-block{grid-template-columns: 1fr; margin-top: -42px;}
  }

  .panel{
    background: var(--card-grad);
    border: 1px solid var(--stroke);
    border-radius: 18px;
    box-shadow: var(--shadow-soft);
    overflow:hidden;
  }

  /* ===== UPDATED: Futuristic ISA blue weather card ===== */
  .wx-card{
    background:
      radial-gradient(circle at 18% 18%, rgba(34,211,238,0.38), transparent 55%),
      radial-gradient(circle at 82% 22%, rgba(129,140,248,0.30), transparent 58%),
      linear-gradient(135deg, #0b2a66 0%, #0a3a8a 40%, #0a57c7 100%);
    border-radius: 18px;
    padding: 26px 26px 18px;
    min-height: 260px;
    position:relative;
    border: 1px solid rgba(255,255,255,0.10);
  }

  .wx-top{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:14px;
  }
  .wx-station-code{
    font-weight:650;
    font-size:0.84rem;
    letter-spacing:0.12em;
    opacity:0.95;
    text-transform:uppercase;
  }
  .wx-station-name{
    margin-top:6px;
    font-weight:650;
    font-size: 1.35rem;
    letter-spacing:0.01em;
  }

  .wx-mid{
    margin-top: 18px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 16px;
  }
  .wx-temp{
    font-size: 3.8rem;
    font-weight: 650;
    letter-spacing:-0.02em;
    line-height:0.95;
  }
  .wx-desc{
    margin-top: 8px;
    font-size: 1.02rem;
    color: rgba(245,250,255,0.9);
    font-weight:520;
  }

  .wx-iconbox{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:8px;
    min-width: 110px;
  }
  .wx-icon{
    width: 68px;
    height: 68px;
    border-radius: 16px;
    background: rgba(255,255,255,0.10);
    border: 1px solid rgba(255,255,255,0.12);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: 28px;
    box-shadow: 0 18px 40px rgba(0,0,0,0.25);
  }
  .wx-icon-label{
    font-weight:600;
    font-size:0.92rem;
    color: rgba(245,250,255,0.9);
  }

  .wx-metrics{
    margin-top: 18px;
    padding-top: 14px;
    border-top: 1px solid rgba(255,255,255,0.14);
    display:grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 12px;
    color: rgba(245,250,255,0.92);
  }
  @media (max-width: 640px){
    .wx-metrics{grid-template-columns: repeat(2, minmax(0, 1fr));}
  }
  .wx-metric .k{
    font-size:0.78rem;
    opacity:0.88;
    letter-spacing:0.06em;
    font-weight:600;
  }
  .wx-metric .v{
    margin-top:6px;
    font-size:1.05rem;
    font-weight:650;
    letter-spacing:0.01em;
  }

  /* Raw METAR strip */
  .raw-strip{
    padding: 14px 16px;
    border-top: 1px solid rgba(255,255,255,0.14);
    background: rgba(0,0,0,0.14);
  }
  .raw-strip .label{
    font-size:0.76rem;
    letter-spacing:0.12em;
    text-transform:uppercase;
    color: rgba(245,250,255,0.78);
    margin-bottom: 8px;
    font-weight:650;
  }
  .raw-strip pre{
    margin:0;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 0.9rem;
    line-height:1.5;
    color: rgba(220,240,255,0.92);
    white-space: pre-wrap;
    word-break: break-word;
  }

  /* what to wear */
  .wear-card{
    border-radius: 18px;
    padding: 18px;
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border: 1px solid rgba(148,163,184,0.14);
    box-shadow: var(--shadow-soft);
    min-height: 260px;
    display:flex;
    flex-direction:column;
    gap: 12px;
  }
  .wear-head{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
    margin-bottom: 2px;
  }
  .wear-title{
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:650;
    font-size: 1.05rem;
  }
  .wear-badge{
    width: 36px;
    height: 36px;
    border-radius: 12px;
    display:flex;
    align-items:center;
    justify-content:center;
    background: rgba(56,189,248,0.14);
    border: 1px solid rgba(56,189,248,0.22);
    box-shadow: 0 0 16px rgba(56,189,248,0.10);
  }
  .wear-temp{
    color: rgba(167,179,214,0.92);
    font-weight:600;
  }

  .wear-field{
    background: rgba(0,0,0,0.14);
    border: 1px solid rgba(148,163,184,0.14);
    border-radius: 12px;
    padding: 12px 12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
  }
  .wear-field .k{color: rgba(167,179,214,0.92); font-weight:600; font-size:0.86rem;}
  .wear-field .v{font-weight:650; color:#eaf4ff; font-size:0.94rem; text-align:right;}

  .wear-note{
    margin-top:auto;
    background: linear-gradient(135deg, rgba(56,189,248,0.12), rgba(34,197,94,0.08));
    border: 1px solid rgba(148,163,184,0.14);
    border-radius: 12px;
    padding: 12px 12px;
    color: rgba(225,250,255,0.92);
    font-weight:520;
    font-size: 0.92rem;
  }

  /* ========= Secondary row ========= */
  .secondary{
    margin-top: 28px;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 22px;
  }
  @media (max-width: 980px){ .secondary{grid-template-columns:1fr;} }

  .card{
    background: var(--card-grad);
    border: 1px solid var(--stroke);
    border-radius: 18px;
    padding: 16px 18px;
    box-shadow: var(--shadow-soft);
  }
  .card h3{
    margin:0 0 10px;
    font-size: 0.92rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(235,245,255,0.92);
    font-weight:650;
  }
  .row{display:flex;align-items:center;justify-content:space-between;gap:12px;}
  .muted{color: var(--muted); font-size:0.9rem;}
  .big{font-size:1.9rem;font-weight:650;}
  .pill{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding: 6px 10px;
    border-radius:999px;
    border: 1px solid rgba(148,163,184,0.18);
    background: rgba(0,0,0,0.14);
    color: rgba(230,245,255,0.9);
    font-weight:650;
    font-size:0.84rem;
    white-space:nowrap;
  }
  input[type="range"]{width:100%; accent-color: var(--a1);}

  /* ========= Explore tiles ========= */
  .explore{
    margin-top: 28px;
    padding: 22px;
    border-radius: 18px;
    border: 1px solid rgba(148,163,184,0.14);
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015));
    box-shadow: 0 18px 46px rgba(0,0,0,0.35);
  }
  .explore h2{
    margin:0 0 14px;
    font-size: 1.15rem;
    font-weight: 650;
    letter-spacing:0.01em;
  }
  .tiles{
    display:grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 14px;
  }
  @media (max-width: 980px){ .tiles{grid-template-columns: repeat(2, minmax(0, 1fr));} }
  @media (max-width: 520px){ .tiles{grid-template-columns: 1fr;} }

  .tile{
    text-decoration:none;
    background: rgba(0,0,0,0.14);
    border: 1px solid rgba(148,163,184,0.14);
    border-radius: 16px;
    padding: 16px;
    min-height: 122px;
    display:flex;
    flex-direction:column;
    gap: 10px;
    transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
  }
  .tile:hover{
    transform: translateY(-6px);
    border-color: rgba(56,189,248,0.30);
    box-shadow: 0 22px 56px rgba(0,0,0,0.5);
  }
  .tile .icon{
    width: 44px;
    height: 44px;
    border-radius: 14px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight: 650;
    color: #071024;
    box-shadow: 0 18px 36px rgba(0,0,0,0.25);
  }
  .i1{background: linear-gradient(135deg, rgba(56,189,248,0.95), rgba(34,211,238,0.90));}
  .i2{background: linear-gradient(135deg, rgba(129,140,248,0.95), rgba(56,189,248,0.85));}
  .i3{background: linear-gradient(135deg, rgba(34,197,94,0.92), rgba(34,211,238,0.85));}
  .i4{background: linear-gradient(135deg, rgba(251,191,36,0.95), rgba(56,189,248,0.75));}

  .tile .t{font-weight:650; font-size:1.02rem;}
  .tile .d{color: rgba(167,179,214,0.9); font-weight:450; font-size:0.92rem; line-height:1.35;}
  .tile .arrow{margin-top:auto; color: rgba(167,179,214,0.95); font-weight:650;}

  /* Footer */
  footer{
    padding: 22px 18px;
    text-align:center;
    color: rgba(167,179,214,0.8);
    border-top: 1px solid rgba(148,163,184,0.10);
    background: #000;
  }

  #dashboard, #explore, #resources { scroll-margin-top: 88px; }
</style>

</head>

<body>
  <!-- TOP NAV -->
  <nav class="top-nav" data-aos="fade-down">
    <div class="top-nav-inner">
      <div class="brand">
        <div class="brand-badge" aria-hidden="true">
          <!-- If you have a logo, set src="isa_logo.png" (or your URL). Otherwise the SVG shows. -->
          <!-- <img src="isa_logo.png" alt="ISA Master Tool Logo"> -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9L2 14v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5L21 16Z"
                  fill="rgba(232,240,255,0.95)"/>
          </svg>
        </div>
        <div class="brand-title">
          <div class="t1">ISA Master Tool</div>
          <div class="t2">Weather ‚Ä¢ Tracking ‚Ä¢ Design</div>
        </div>
      </div>

      <!-- TOP MENU: only these -->
      <div class="menu" aria-label="Main navigation">
        <a href="flight_tracker.html" target="_blank" rel="noopener">Flight Tracker</a>
        <a href="isa_designer.html" target="_blank" rel="noopener">ISA Designer</a>
        <a href="isa_new.html" target="_blank" rel="noopener">News</a>
        <a href="learning.html" target="_blank" rel="noopener">Learning</a>
      </div>
    </div>
  </nav>

  <!-- HERO (NO big header, just search; lottie is true background) -->
  <section class="hero">
    <div class="hero-bg-lottie" aria-hidden="true">
      <lottie-player
        src="https://lottie.host/68ecc80f-3865-4071-89bf-1db845e65c6e/O67It7eqk8.json"
        background="transparent"
        speed="1"
        loop
        autoplay>
      </lottie-player>
    </div>
    <div class="hero-overlay" aria-hidden="true"></div>

    <div class="hero-inner">
      <h1 class="hero-title">ISA Master Tool</h1>
      <p class="hero-sub">
        Search a city, ZIP, or airport code to load weather + METAR.
      </p>

      <div class="hero-search" data-aos="fade-up">
        <input id="global-search" type="text" placeholder="Search city, ZIP, IATA/ICAO (e.g., LAX, KLAX, Long Beach, 90802)" autocomplete="off">
        <button id="global-search-btn" type="button">Search</button>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <section class="section" id="dashboard">
    <div class="wrap">
      <!-- Weather + What to Wear -->
      <div class="weather-block">
        <!-- Big weather card -->
        <div class="panel">
          <div class="wx-card" aria-live="polite">
            <div class="wx-top">
              <div>
                <div class="wx-station-code" id="hero-station-code">KLGB</div>
                <div class="wx-station-name" id="hero-station-name">Long Beach Airport</div>
              </div>
              <div class="wx-iconbox">
                <div class="wx-icon" id="hero-icon">‚òÄÔ∏è</div>
                <div class="wx-icon-label" id="hero-small">Clear</div>
              </div>
            </div>

            <div class="wx-mid">
              <div>
                <div class="wx-temp">
                  <span id="hero-temp">‚Äî</span><span style="font-size:1.2rem;font-weight:900;opacity:0.92;margin-left:6px;">¬∞C</span>
                </div>
                <div class="wx-desc" id="hero-desc">‚Äî</div>
              </div>
            </div>

            <div class="wx-metrics">
              <div class="wx-metric">
                <div class="k">Wind</div>
                <div class="v" id="hero-wind">‚Äî</div>
              </div>
              <div class="wx-metric">
                <div class="k">Feels Like</div>
                <div class="v" id="hero-feels">‚Äî</div>
              </div>
              <div class="wx-metric">
                <div class="k">Visibility</div>
                <div class="v" id="hero-vis">‚Äî</div>
              </div>
              <div class="wx-metric">
                <div class="k">Pressure</div>
                <div class="v" id="hero-pres">‚Äî</div>
              </div>
            </div>
          </div>

          <div class="raw-strip">
            <div class="label">Raw METAR</div>
            <pre id="hero-raw">‚Äî</pre>
          </div>
        </div>

        <!-- What to wear -->
        <aside class="wear-card" aria-label="What to wear">
          <div class="wear-head">
            <div class="wear-title">
              <div class="wear-badge" aria-hidden="true">üëï</div>
              <div>What to Wear</div>
            </div>
            <div class="wear-temp" id="wear-temp-small">‚Äî</div>
          </div>

          <div class="wear-field"><div class="k">Top</div><div class="v" id="wear-top-val">‚Äî</div></div>
          <div class="wear-field"><div class="k">Bottom</div><div class="v" id="wear-bottom-val">‚Äî</div></div>
          <div class="wear-field"><div class="k">Footwear</div><div class="v" id="wear-foot-val">‚Äî</div></div>
          <div class="wear-field"><div class="k">Accessories</div><div class="v" id="wear-access-val">‚Äî</div></div>

          <div class="wear-note" id="wear-note">üí° Dress in layers to adjust to changing conditions.</div>
        </aside>
      </div>

      <!-- Secondary row -->
      <div class="secondary">
        <div class="card">
          <h3>Local Time & Winds Aloft</h3>
          <div class="row">
            <div>
              <div class="muted">Location</div>
              <div style="font-weight:950;font-size:1.15rem" id="city-label">Long Beach, CA</div>
              <div class="muted" id="date-line">‚Äî</div>
            </div>
            <div style="text-align:right">
              <div class="muted">Local time</div>
              <div class="big" id="clock">--:--</div>
            </div>
          </div>

          <div style="height:14px"></div>

          <div class="row" style="align-items:flex-end">
            <div style="flex:1">
              <div class="muted" style="font-weight:800">Cruise Altitude</div>
              <input id="alt-ft" type="range" min="0" max="42000" step="1000" value="8000">
              <div class="muted"><span id="alt-ft-label">8,000</span> ft</div>
            </div>
            <div style="text-align:right; min-width: 170px;">
              <div class="muted" style="font-weight:800">Winds Aloft</div>
              <div class="pill" id="winds-aloft">‚Äî</div>
              <div class="muted" id="winds-aloft-sub" style="margin-top:6px">‚Äî</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Airport / METAR Search</h3>
          <div class="muted" style="margin-bottom:10px">Type ICAO/IATA/city (e.g. KLAX, LAX, Colombo). Select from dropdown.</div>

          <div style="display:flex;gap:10px;align-items:center;position:relative">
            <input id="airport-search" type="text"
              style="flex:1;padding:12px 14px;border-radius:12px;border:1px solid rgba(148,163,184,0.18);background:rgba(255,255,255,0.06);color:var(--text);outline:none"
              placeholder="Search airport..."
              autocomplete="off" />
            <button id="metar-btn" type="button"
              style="padding:12px 14px;border-radius:12px;border:none;font-weight:900;cursor:pointer;background:linear-gradient(135deg, rgba(56,189,248,0.95), rgba(129,140,248,0.95));color:#061021">
              Get METAR
            </button>

            <div id="airport-dd"
              style="position:absolute;left:0;right:0;top:calc(100% + 8px);background:rgba(2, 6, 23, 0.96);border:1px solid rgba(148,163,184,0.18);border-radius:14px;overflow:hidden;box-shadow:0 24px 70px rgba(0,0,0,0.6);display:none;z-index:9999">
            </div>
          </div>

          <!-- hidden ‚Äúsource‚Äù fields used by syncHeroWeather -->
          <div style="display:none">
            <div id="wx-conditions">‚Äî</div>
            <div id="wx-wind">‚Äî</div>
            <div id="wx-pressure">‚Äî</div>

            <div id="metar-station">‚Äî</div>
            <div id="metar-summary">‚Äî</div>
            <div id="metar-temp">‚Äî</div>
            <div id="metar-vis">‚Äî</div>
            <div id="metar-raw">‚Äî</div>
          </div>

          <div class="muted" style="margin-top:12px">
            Tip: global search above also works (city/zip/airport).
          </div>
        </div>
      </div>

      <!-- Explore (ONLY 4 tools) -->
      <div class="explore" id="explore" data-aos="fade-up">
        <h2>Explore ISA Master Tool</h2>
        <div class="tiles">
          <a class="tile" href="flight_tracker.html" target="_blank" rel="noopener">
            <div class="icon i1">‚úà</div>
            <div class="t">Flight Tracker</div>
            <div class="d">Track any flight in real-time.</div>
            <div class="arrow">‚Ä∫</div>
          </a>

          <a class="tile" href="isa_designer.html" target="_blank" rel="noopener">
            <div class="icon i2">üõ†</div>
            <div class="t">ISA Designer</div>
            <div class="d">Design & simulate aircraft concepts.</div>
            <div class="arrow">‚Ä∫</div>
          </a>

          <a class="tile" href="isa_new.html" target="_blank" rel="noopener">
            <div class="icon i3">üì∞</div>
            <div class="t">News</div>
            <div class="d">Latest aviation & space news.</div>
            <div class="arrow">‚Ä∫</div>
          </a>

          <a class="tile" href="learning.html" target="_blank" rel="noopener">
            <div class="icon i4">üìö</div>
            <div class="t">Learning</div>
            <div class="d">Aero resources & guides.</div>
            <div class="arrow">‚Ä∫</div>
          </a>
        </div>
      </div>
    </div>
  </section>

  <footer id="resources">
    ¬© 2025 Ashwin Ganesh ‚Äî ISA Master Tool
  </footer>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({ duration: 850, easing: 'ease-out-cubic', offset: 120, once: true });

    // ===== clock =====
    function updateClock() {
      const now = new Date();
      document.getElementById("clock").textContent = now.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
      document.getElementById("date-line").textContent = now.toLocaleDateString(undefined, {weekday:"long", month:"short", day:"numeric", year:"numeric"});
    }
    updateClock();
    setInterval(updateClock, 1000);

    // ===== endpoints =====
    const ISA_BACKEND_BASE = "https://isa-backend-olj9.onrender.com/api";
    const ISA_METAR_ENDPOINT = `${ISA_BACKEND_BASE}/metar`;

    // ===== airport dataset + fuse =====
    let AIRPORTS = [];
    let fuse = null;

    const searchEl = document.getElementById("airport-search");
    const ddEl = document.getElementById("airport-dd");
    const metarBtn = document.getElementById("metar-btn");

    function showDropdown(on){ ddEl.style.display = on ? "block" : "none"; }

    function airportLabel(a){
      const code = a.icao + (a.iata ? ` (${a.iata})` : "");
      const right = [a.city, a.name].filter(Boolean).join(" ‚Äî ");
      const country = a.country ? ` ¬∑ ${a.country}` : "";
      return right ? `${code} ‚Äî ${right}${country}` : `${code}${country}`;
    }

    function renderDropdown(list){
      ddEl.innerHTML = "";
      if (!list || !list.length){
        ddEl.innerHTML = `<div style="padding:10px 12px;color:#a6b4d9;font-size:0.9rem">No matches ‚Äî press Enter to try ICAO/IATA</div>`;
        showDropdown(true);
        return;
      }

      list.slice(0, 10).forEach(a => {
        const d = document.createElement("div");
        d.textContent = airportLabel(a);
        d.style.padding = "10px 12px";
        d.style.cursor = "pointer";
        d.style.borderBottom = "1px solid rgba(148,163,184,0.10)";
        d.style.color = "#e5ecff";
        d.onmouseenter = () => d.style.background = "rgba(56,189,248,0.10)";
        d.onmouseleave = () => d.style.background = "transparent";
        d.onmousedown = (e) => {
          e.preventDefault();
          searchEl.value = airportLabel(a);
          showDropdown(false);

          if (a.lat != null && a.lon != null){
            ISA_LAT = Number(a.lat);
            ISA_LON = Number(a.lon);
          }
          if (a.city) document.getElementById("city-label").textContent = a.city + (a.country ? `, ${a.country}` : "");
          if (a.name) document.getElementById("hero-station-name").textContent = a.name;

          fetchMetar(a.icao);
        };
        ddEl.appendChild(d);
      });
      showDropdown(true);
    }

    fetch("./airports.min.json", { cache: "no-store" })
      .then(r => r.json())
      .then(data => {
        AIRPORTS = data || [];
        fuse = new Fuse(AIRPORTS, { threshold: 0.35, keys: ["icao","iata","name","city","country"] });
      })
      .catch(err => {
        console.error("Could not load airports.min.json", err);
        fuse = null;
      });

    let searchTimer = null;
    searchEl.addEventListener("input", () => {
      const q = (searchEl.value || "").trim();
      if (!q || q.length < 2 || !fuse) { showDropdown(false); return; }
      if (searchTimer) clearTimeout(searchTimer);
      searchTimer = setTimeout(() => {
        const res = fuse.search(q).map(r => r.item);
        renderDropdown(res);
      }, 110);
    });

    document.addEventListener("click", (e) => {
      if (!ddEl.contains(e.target) && e.target !== searchEl) showDropdown(false);
    });

    searchEl.addEventListener("keydown", (e) => {
      if (e.key === "Escape") { showDropdown(false); return; }
      if (e.key === "Enter") {
        e.preventDefault();
        showDropdown(false);
        fetchMetar(searchEl.value);
      }
    });

    metarBtn.addEventListener("click", () => fetchMetar(searchEl.value));

    // ===== global search (city/zip/airport) =====
    const globalEl = document.getElementById("global-search");
    const globalBtn = document.getElementById("global-search-btn");
    globalBtn.addEventListener("click", onGlobalSearch);
    globalEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter") onGlobalSearch(); });

    async function geocode(q){
      try{
        const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(q)}&count=5&language=en&format=json`;
        const r = await fetch(url);
        if (!r.ok) return null;
        const data = await r.json();
        return (data && data.results && data.results.length) ? data.results[0] : null;
      }catch(e){ return null; }
    }

    function extractICAO(text) {
      const t = String(text || "").trim().toUpperCase();
      const m4 = t.match(/\b[A-Z0-9]{4}\b/);
      if (m4) return m4[0];
      const m3 = t.match(/\b[A-Z0-9]{3}\b/);
      return m3 ? m3[0] : null;
    }

    async function onGlobalSearch(){
      const q = (globalEl.value || "").trim();
      if(!q) return;

      const code = extractICAO(q);
      if (code && AIRPORTS && AIRPORTS.length){
        const codeUp = code.toUpperCase();
        const match = AIRPORTS.find(a =>
          String(a.icao||"").toUpperCase() === codeUp ||
          String(a.iata||"").toUpperCase() === codeUp
        );
        if (match){
          if (match.lat != null && match.lon != null){
            ISA_LAT = Number(match.lat);
            ISA_LON = Number(match.lon);
          }
          if (match.city) document.getElementById("city-label").textContent = match.city + (match.country ? `, ${match.country}` : "");
          if (match.name) document.getElementById("hero-station-name").textContent = match.name;

          fetchMetar(match.icao || codeUp);
          refreshWXandWinds();
          return;
        }
        fetchMetar(codeUp);
      }

      const g = await geocode(q);
      if (!g){
        if (code) fetchMetar(code);
        return;
      }
      ISA_LAT = g.latitude;
      ISA_LON = g.longitude;
      document.getElementById("city-label").textContent = `${g.name}${g.admin1 ? ", " + g.admin1 : ""}${g.country ? ", " + g.country : ""}`;
      document.getElementById("hero-station-name").textContent = `${g.name}${g.admin1 ? ", " + g.admin1 : ""}`;
      refreshWXandWinds();
    }

    // ===== wind/pressure globals for feels-like =====
    let LAST_SURFACE_TEMP_C = null;
    let LAST_WIND_KT = null;

    // ===== surface weather + winds aloft =====
    let ISA_LAT = 33.8177;
    let ISA_LON = -118.1516;

    function altitudeToPressureLevel(altFt) {
      if (altFt <= 5000) return 850;
      if (altFt <= 12000) return 700;
      if (altFt <= 18000) return 600;
      if (altFt <= 24000) return 500;
      if (altFt <= 30000) return 400;
      if (altFt <= 36000) return 300;
      return 250;
    }

    function hpaToInhg(hpa){
      if (hpa == null) return null;
      return hpa * 0.029529983071445;
    }

    function windChillC(tempC, windKmh){
      if (tempC == null || windKmh == null) return null;
      if (tempC > 10 || windKmh < 4.8) return tempC;
      return 13.12 + 0.6215*tempC - 11.37*Math.pow(windKmh,0.16) + 0.3965*tempC*Math.pow(windKmh,0.16);
    }

    async function fetchSurfaceWeather(lat, lon) {
      const url =
        "https://api.open-meteo.com/v1/forecast?" +
        `latitude=${encodeURIComponent(lat)}&longitude=${encodeURIComponent(lon)}` +
        "&current=temperature_2m,relative_humidity_2m,pressure_msl,wind_speed_10m,wind_direction_10m" +
        "&hourly=temperature_2m,wind_speed_10m,wind_direction_10m,precipitation" +
        "&forecast_days=1&timezone=auto";

      const res = await fetch(url);
      if (!res.ok) throw new Error("Open-Meteo weather fetch failed");
      const data = await res.json();

      const t = data.current.temperature_2m;
      const p_hpa = data.current.pressure_msl;
      const ws_ms = data.current.wind_speed_10m;
      const wd = data.current.wind_direction_10m;

      const wsKt = (ws_ms * 1.9438444924406);
      const p_inhg = hpaToInhg(p_hpa);

      document.getElementById("wx-conditions").textContent = (t == null) ? "‚Äî" : `${Math.round(t)}¬∞C`;
      document.getElementById("wx-wind").textContent = (wd == null || wsKt == null) ? "‚Äî" : `${Math.round(wsKt)} kts @ ${Math.round(wd)}¬∞`;
      document.getElementById("wx-pressure").textContent = (p_inhg == null) ? "‚Äî" : `${p_inhg.toFixed(2)}" Hg`;

      LAST_SURFACE_TEMP_C = (t == null) ? null : Number(t);
      LAST_WIND_KT = (wsKt == null) ? null : Number(wsKt);

      const precip0 = (data.hourly && data.hourly.precipitation && data.hourly.precipitation.length) ? (data.hourly.precipitation[0] || 0) : 0;
      updateWhatToWear(LAST_SURFACE_TEMP_C, precip0);

      syncHeroWeather();
    }

    async function fetchWindsAloft(lat, lon, altFt) {
      const level = altitudeToPressureLevel(altFt);
      const url =
        "https://api.open-meteo.com/v1/forecast?" +
        `latitude=${encodeURIComponent(lat)}&longitude=${encodeURIComponent(lon)}` +
        `&hourly=windspeed_${level}hPa,winddirection_${level}hPa` +
        "&forecast_days=1&timezone=auto";

      const res = await fetch(url);
      if (!res.ok) throw new Error("Open-Meteo winds aloft fetch failed");
      const data = await res.json();

      const ws = data.hourly[`windspeed_${level}hPa`][0];
      const wd = data.hourly[`winddirection_${level}hPa`][0];

      const wsKt = (ws * 0.539957);
      document.getElementById("winds-aloft").textContent = `${Math.round(wd)}¬∞ / ${Math.round(wsKt)} kt`;
      document.getElementById("winds-aloft-sub").textContent = `${level} hPa`;
    }

    function refreshWXandWinds() {
      const alt = parseInt(document.getElementById("alt-ft").value, 10);
      document.getElementById("alt-ft-label").textContent = alt.toLocaleString();
      fetchSurfaceWeather(ISA_LAT, ISA_LON).catch(console.error);
      fetchWindsAloft(ISA_LAT, ISA_LON, alt).catch(console.error);
    }

    // ===== METAR fetch (backend) =====
    async function fetchMetar(input) {
      const code = extractICAO(input);
      if (!code) return;

      try {
        const res = await fetch(`${ISA_METAR_ENDPOINT}/${encodeURIComponent(code)}?t=${Date.now()}`, { cache: "no-store" });

        if (res.status === 204) {
          document.getElementById("metar-station").textContent = code;
          document.getElementById("metar-summary").textContent = "No recent METAR returned.";
          document.getElementById("metar-temp").textContent = "‚Äî";
          document.getElementById("metar-vis").textContent = "‚Äî";
          document.getElementById("metar-raw").textContent = "‚Äî";
          syncHeroWeather();
          return;
        }

        const data = await res.json();
        if (!data?.raw_text) return;

        document.getElementById("metar-station").textContent = data.icao || code;
        document.getElementById("metar-temp").textContent = (data.temp_c == null) ? "‚Äî" : `${data.temp_c} ¬∞C`;
        document.getElementById("metar-vis").textContent = (data.visibility_mi == null) ? "‚Äî" : `${data.visibility_mi} SM`;
        document.getElementById("metar-raw").textContent = data.raw_text || "‚Äî";

        const summary = (data.sky && data.sky !== "‚Äî") ? data.sky : "METAR available below.";
        document.getElementById("metar-summary").textContent = summary;

        const st = String(data.icao || code).toUpperCase();
        const match = AIRPORTS.find(a => String(a.icao||"").toUpperCase() === st || String(a.iata||"").toUpperCase() === st);
        if (match?.name) document.getElementById("hero-station-name").textContent = match.name;

        syncHeroWeather();
      } catch (e) {
        console.error(e);
      }
    }

    // ===== What-to-wear logic =====
    function updateWhatToWear(tempC, precipMm){
      const top = document.getElementById("wear-top-val");
      const bottom = document.getElementById("wear-bottom-val");
      const foot = document.getElementById("wear-foot-val");
      const access = document.getElementById("wear-access-val");
      const note = document.getElementById("wear-note");

      if (tempC == null || isNaN(Number(tempC))){
        top.textContent = "‚Äî";
        bottom.textContent = "‚Äî";
        foot.textContent = "‚Äî";
        access.textContent = "‚Äî";
        note.textContent = "üí° Dress in layers to adjust to changing conditions.";
        return;
      }

      const t = Number(tempC);
      const rainy = (precipMm || 0) > 0.1;

      if (t < 0){
        top.textContent = "Thermal + heavy coat";
        bottom.textContent = "Insulated pants";
        foot.textContent = rainy ? "Waterproof boots" : "Winter boots";
        access.textContent = "Hat, gloves, scarf";
      } else if (t < 8){
        top.textContent = "Jacket + warm layer";
        bottom.textContent = "Thick pants";
        foot.textContent = rainy ? "Waterproof shoes" : "Sneakers";
        access.textContent = "Light gloves";
      } else if (t < 16){
        top.textContent = "Hoodie / light jacket";
        bottom.textContent = "Jeans / trousers";
        foot.textContent = "Sneakers";
        access.textContent = rainy ? "Umbrella" : "‚Äî";
      } else if (t < 25){
        top.textContent = "T-shirt + light layer";
        bottom.textContent = "Light pants";
        foot.textContent = "Sneakers";
        access.textContent = "Sunglasses";
      } else {
        top.textContent = "T-shirt";
        bottom.textContent = "Shorts / light pants";
        foot.textContent = "Sneakers";
        access.textContent = "Sunglasses";
      }

      note.textContent = rainy
        ? "‚òî Light precipitation possible ‚Äî keep a layer & umbrella handy."
        : "üí° Dress in layers to adjust to changing conditions.";
    }

    // ===== Sync Hero =====
    function syncHeroWeather() {
      const temp = document.getElementById("wx-conditions")?.textContent || "‚Äî";
      const wind = document.getElementById("wx-wind")?.textContent || "‚Äî";
      const pres = document.getElementById("wx-pressure")?.textContent || "‚Äî";

      const station = document.getElementById("metar-station")?.textContent || "‚Äî";
      const summary = document.getElementById("metar-summary")?.textContent || "‚Äî";
      const mt = document.getElementById("metar-temp")?.textContent || "‚Äî";
      const vis = document.getElementById("metar-vis")?.textContent || "‚Äî";
      const raw = document.getElementById("metar-raw")?.textContent || "‚Äî";

      document.getElementById("hero-station-code").textContent = station || "‚Äî";

      const heroTemp = (mt && mt !== "‚Äî") ? mt.replace(" ¬∞C","") : temp.replace("¬∞C","");
      document.getElementById("hero-temp").textContent = heroTemp || "‚Äî";

      document.getElementById("wear-temp-small").textContent = (mt && mt !== "‚Äî") ? mt : temp;
      document.getElementById("hero-desc").textContent = (summary && summary !== "‚Äî") ? summary : "‚Äî";
      document.getElementById("hero-wind").textContent = wind || "‚Äî";
      document.getElementById("hero-vis").textContent = vis || "‚Äî";
      document.getElementById("hero-pres").textContent = pres || "‚Äî";
      document.getElementById("hero-raw").textContent = raw || "‚Äî";

      let feels = "‚Äî";
      if (LAST_SURFACE_TEMP_C != null && LAST_WIND_KT != null){
        const windKmh = LAST_WIND_KT * 1.852;
        const wc = windChillC(LAST_SURFACE_TEMP_C, windKmh);
        feels = `${Math.round(wc)}¬∞C`;
      }
      document.getElementById("hero-feels").textContent = feels;

      const desc = (summary || "").toLowerCase();
      const iconEl = document.getElementById("hero-icon");
      const smallEl = document.getElementById("hero-small");
      if (desc.includes("snow")) { iconEl.textContent = "‚ùÑÔ∏è"; smallEl.textContent = "Snow"; }
      else if (desc.includes("rain") || desc.includes("shower") || desc.includes("precip") || desc.includes("drizzle")) { iconEl.textContent = "üåßÔ∏è"; smallEl.textContent = "Rain"; }
      else if (desc.includes("mist") || desc.includes("fog")) { iconEl.textContent = "üå´Ô∏è"; smallEl.textContent = "Fog"; }
      else if (desc.includes("cloud") || desc.includes("ovc") || desc.includes("bkn")) { iconEl.textContent = "‚òÅÔ∏è"; smallEl.textContent = "Cloudy"; }
      else { iconEl.textContent = "‚òÄÔ∏è"; smallEl.textContent = "Clear"; }

      let tnum = null;
      const m = (mt || "").match(/(-?\d+\.?\d*)/);
      if (m) tnum = Number(m[1]);
      if (tnum == null && LAST_SURFACE_TEMP_C != null) tnum = Number(LAST_SURFACE_TEMP_C);

      const precipFlag = /rain|shower|snow|precip|sleet|drizzle/i.test(summary);
      updateWhatToWear(tnum, precipFlag ? 1 : 0);
    }

    // ===== init + slider =====
    document.addEventListener("DOMContentLoaded", () => {
      refreshWXandWinds();

      const slider = document.getElementById("alt-ft");
      slider.addEventListener("input", () => {
        document.getElementById("alt-ft-label").textContent = parseInt(slider.value,10).toLocaleString();
      });
      slider.addEventListener("change", refreshWXandWinds);

      fetchMetar("KLGB");
      setInterval(refreshWXandWinds, 10 * 60 * 1000);
    });
  </script>
</body>
</html>